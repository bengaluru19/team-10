<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="chat.css">
</head>
<body>

<button class="open-button" onclick="openForm()">Chat</button>

<div class="chat-popup" id="myForm">
  <div class="form-container">
    <h1>Chat</h1>
    <div class="container" id="User" >
        <p>Hello. How are you today?</p>
       
    </div>
          
    <div class="container darker" id="Bot">
        <p>Hey! I'm fine. Thanks for asking!</p>
       
    </div>

    <textarea  id="chatArea" placeholder="Type message.." name="msg" required></textarea>

    <button  class="btn" onclick="chatbot()">Send</button>
    <button type="button" class="btn cancel" onclick="closeForm()">Close</button>
  </div>
</div>

<script>
    know = {
                "hello" : "Welcome to AntHill Creations",
                "hi" : "Welcome to AntHill Creations, ask me anything regarding the form?",
                "site area" : "You can give us estimations",
                "vandalism" : "action involving deliberate destruction of or damage to public or private property.",
                "soil condition" : "We'll contact you and give you the details",
                "snake prone area?" : "Snakes thrive in areas where there are plenty of frogs, birds and small mammals, such areas are usually snake prone.",
                "learning?" : "Yes we are.",
                "maintain the playground?" : "We will send volunteers for it."
                };
function openForm() {

  document.getElementById("myForm").style.display = "block";
  
}

function similarity(s1, s2) {
  var longer = s1;
  var shorter = s2;
  if (s1.length < s2.length) {
    longer = s2;
    shorter = s1;
  }
  var longerLength = longer.length;
  if (longerLength == 0) {
    return 1.0;
  }
  return (longerLength - editDistance(longer, shorter)) / parseFloat(longerLength);
}

function editDistance(s1, s2) {
  s1 = s1.toLowerCase();
  s2 = s2.toLowerCase();

  var costs = new Array();
  for (var i = 0; i <= s1.length; i++) {
    var lastValue = i;
    for (var j = 0; j <= s2.length; j++) {
      if (i == 0)
        costs[j] = j;
      else {
        if (j > 0) {
          var newValue = costs[j - 1];
          if (s1.charAt(i - 1) != s2.charAt(j - 1))
            newValue = Math.min(Math.min(newValue, lastValue),
              costs[j]) + 1;
          costs[j - 1] = lastValue;
          lastValue = newValue;
        }
      }
    }
    if (i > 0)
      costs[s2.length] = lastValue;
  }
  return costs[s2.length];
}

function chatbot()
{
    var user = document.getElementById("User");
    var input = document.getElementById("chatArea").value;
    var inputarr=input.replace(" ",'+');
    console.log("inputarr "+inputarr);
    var apiEndPoint = "https://api.textgears.com/check.php?text="+inputarr+"&key=DEMO_KEY";
    var request = new XMLHttpRequest();
    request.open('GET', apiEndPoint , true);
    request.send();
    
    //api sttuffs`
    request.onload = function() {
        // Begin accessing JSON data here
            var data = JSON.parse(this.response)
            console.log(request.status);
            if (request.status >= 200 && request.status < 400) {
                var error = data.errors;
                error.forEach(element => {
                    input=input.replace(element.bad,element.better[0]);
                });
                console.log(input); 
                user.innerHTML = input;
                var max=0;
                for(var key in know)
                {
                    if(similarity(key,input)>max)
                    {
                        max=similarity(key,input);
                        output = know[key];
                    }
                }
                bot.innerHTML = output;
            }
        }
    
    //api stuffs ends

    var bot = document.getElementById("Bot");
    console.log(input);
    user.innerHTML = input;
    user.style.display = "block";
    var output = "helloa";
    if (input in know) {
        output= know[input];
        } else {
        output = "I don't understand...";
    }
    bot.innerHTML = output;
    bot.style.display = "block";
}

function closeForm() {
  document.getElementById("myForm").style.display = "none";
}
</script>

</body>
</html>
